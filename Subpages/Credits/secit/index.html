<!DOCTYPE html>
<script src="https://js-dos.com/6.22/current/js-dos.js"></script>
<style>
  canvas {
    width: 100%;
    height: 100%;
    margin: auto;
    padding: 0;
  }
  .dosbox-container {
    width: 640px;
    height: 480px;
    margin: auto;
    padding: 0;
  }
  #controls-heading, #controls-list {
    padding-left: 50px;
  }
</style>
<script type="text/javascript">
  var els, i, len, title;
  var konamiCode = '38,38,40,40,37,39,37,39,66,65';
  var keyPresses = [];
  var checkKonami = function (e) {
    keyPresses.push(e.keyCode);
    if (keyPresses.slice(keyPresses.length - 10).join() === konamiCode) {
      runKonami();
    }
  };
  var runKonami = function () {
    console.log('konami code activated!');
    dataLayer.push({
      'event': 'doom_launched'
    });
    
    // Create new site section
    var doomSection = document.createElement('section');
    doomSection.setAttribute('id', 'doomSection');
    
    // Create and append dosbox container
    var dosboxContainer = document.createElement('canvas');
    dosboxContainer.setAttribute('id', 'jsdos');
    doomSection.appendChild(dosboxContainer);
    
    var div1 = document.createElement('div');
    div1.setAttribute('class', 'row no-gutters');
    doomSection.appendChild(div1);
    
    var div2 = document.createElement('div');
    div2.setAttribute('class', 'col-md-7 left-fullwidth-block white-bg my-auto ');
    div1.appendChild(div2);
    
    var div3 = document.createElement('div');
    div3.setAttribute('class', 'content-center');
    div2.appendChild(div3);
    
    // Create and append controls list
    var controls = ["Move: UP, DOWN, LEFT, RIGHT", "Use: W", "Fire: S", "Speed on: SPACE", "Strafe on: ALT", "Strafe: A, D"];
    var controlsHeading = document.createElement('h3');
    controlsHeading.setAttribute('id', 'controls-heading');
    controlsHeading.innerText = 'Controls';
    var controlsList = document.createElement('ul');
    controlsList.setAttribute('id', 'controls-list');
    for (var i = 0; i < controls.length; i++) {
        var item = document.createElement('li');
        item.appendChild(document.createTextNode(controls[i]));
        controlsList.appendChild(item);
    }
    div3.appendChild(controlsHeading);
    div3.appendChild(controlsList);
    
    // Create and append Fullscreen button
    var doomFullscreenBtn = document.createElement('button');
    doomFullscreenBtn.setAttribute('id', 'fullscreenBtn');
    doomFullscreenBtn.setAttribute('onclick', 'ci.fullscreen()');
    doomFullscreenBtn.innerText = 'Fullscreen';
    div3.appendChild(doomFullscreenBtn);
    
    // Inject section
    document.querySelector('body > main').prepend(doomSection);
    
    // Run dosbox and extract + load DOOM
    Dos(document.getElementById("jsdos"), {
        wdosboxUrl: "https://js-dos.com/6.22/current/wdosbox.js",
        // cycles: 1000,
        // autolock: false,
    }).ready(function (fs, main) {
      fs.extract("https://js-dos.com/cdn/upload/DOOM-@evilution.zip").then(function () {
        main(["-c", "cd DOOM", "-c", "DOOM.EXE"]).then(function (ci) {
            window.ci = ci;
        });
      });
    });
  };
  document.addEventListener('keyup', checkKonami);
</script>
<script src="https://js-dos.com/6.22/current/js-dos.js"></script>